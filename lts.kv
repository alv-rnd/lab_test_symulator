#:import MeshLinePlot kivy.garden.graph.MeshLinePlot

<CustomTextInput@TextInput>:
    multiline: False
    size_hint: 1, None
    hint_text: "int"
    input_filter: 'int'
    write_tab: False

<CustomLabel@Label>:
    size_hint: 1, None
    height: self.texture_size[1] + (self.texture_size[1] / 1.5)
    font_size:
    text: "None"

<QuestionButton@Button>:
    size_hint: .3, None
    text: "?"

<LtsBoxLayout>:
#---Pasek menu (ActionBar)---#
    orientation: "vertical"
    fullscreen: True
    id: main
    main: main
    graphs_screens_py: graphs_screens_kv
    screen_text_py: screen_text_kv
    graph_1_py: graph_1_kv
    time_slider_py: time_slider_kv
    excel_py: excel_kv
    graph_2_screen_py: graph_2_kv

    ActionBar:
        ActionView:
            use_separator: True
            ActionPrevious:
                with_previous: False
                app_icon: "logo.png"
                title: "Symulacja procesu COP"
            ActionButton:
                id: excel_kv
                text: "Exportuj do excela"
                on_release: root.export.export_show()
            ActionButton:
                text: "Ustawienia"
                on_release: app.open_settings()

    BoxLayout:
        orientation: "horizontal"

        BoxLayout:
            orientation: "vertical"
            size_hint_x: .3

            BoxLayout:
                orientation: "vertical"
                padding: 5, 20, 8, 20
                Label:
                    size_hint_y: None
                    height: self.texture_size[1]
                    #halign: 'left'
                    text: "Ustawienia glowne"

                GridLayout:
                ### G??wne parametry symulacji ###
                    cols: 2
                    row_force_default: True
                    row_default_height: 40

                    CustomLabel:
                        id: label_test_qty
                        text: "Iloœæ testów:"
                    BoxLayout:
                        orientation: 'horizontal'
                        CustomTextInput:
                            id: test_qty
                            height: label_test_qty.size[1]
                            hint_text: "qty"
                            text: "100"
                        QuestionButton:
                            id: test_text
                            pos: label_test_qty.x, label_test_qty.texture_size[1] / 2
                            height: label_test_qty.size[1]
                            on_release: root.questionpopup.open("test_text")


                    CustomLabel:
                        id: label_project_qty
                        text: "Iloœæ Projektów:"
                    BoxLayout:
                        orientation: 'horizontal'
                        CustomTextInput:
                            id: project_qty
                            height: label_project_qty.size[1]
                            hint_text: "qty"
                            text: "6"
                        QuestionButton:
                            id: project_text
                            pos: label_project_qty.x, label_project_qty.texture_size[1] / 2
                            height: label_project_qty.size[1]
                            on_release: root.questionpopup.open("project_text")

                    CustomLabel:
                        id: label_tc_cap
                        text: "Pojemnoœæ komór:"
                    BoxLayout:
                        orientation: 'horizontal'
                        CustomTextInput:
                            id: tc_cap
                            height: label_tc_cap.size[1]
                            hint_text: "cap"
                            text: "20"
                        QuestionButton:
                            id: tc_cap_text
                            pos: label_tc_cap.x, label_tc_cap.texture_size[1] / 2
                            height: label_tc_cap.size[1]
                            on_release: root.questionpopup.open("tc_cap_text")

                    CustomLabel:
                        id: label_tr_qty
                        text: "Iloœæ TR:"
                    BoxLayout:
                        orientation: 'horizontal'
                        CustomTextInput:
                            id: tr_qty
                            height: label_tr_qty.size[1]
                            hint_text: "qty"
                            text: "4"
                        QuestionButton:
                            id: tr_text
                            pos: label_tr_qty.x, label_tr_qty.texture_size[1] / 2
                            height: label_tr_qty.size[1]
                            on_release: root.questionpopup.open("tr_text")

                    CustomLabel:
                        id: label_trunk_cap
                        text: "Pojemnoœæ trumny:"
                    BoxLayout:
                        orientation: 'horizontal'
                        CustomTextInput:
                            id: trunk_cap
                            height: label_trunk_cap.size[1]
                            hint_text: "qty/day"
                            text: "80"
                        QuestionButton:
                            id: trunk_text
                            pos: label_trunk_cap.x, label_trunk_cap.texture_size[1] / 2
                            height: label_trunk_cap.size[1]
                            on_release: root.questionpopup.open("trunk_text")

                    CustomLabel:
                        id: label_at_qty
                        text: "Iloœæ AT:"
                    BoxLayout:
                        orientation: 'horizontal'
                        CustomTextInput:
                            id: at_qty
                            height: label_at_qty.size[1]
                            hint_text: "qty"
                            text: "6"
                        QuestionButton:
                            id: at_qty_text
                            pos: label_at_qty.x, label_at_qty.texture_size[1] / 2
                            height: label_at_qty.size[1]
                            on_release: root.questionpopup.open("at_qty_text")

                    CustomLabel:
                        id: label_tc_refill_time
                        text: "Czêstoœæ wrzutów:"
                    BoxLayout:
                        orientation: 'horizontal'
                        BoxLayout:
                            id: tc_refill_time_box
                            CustomTextInput:
                                id: tc_refill_time
                                height: label_tc_refill_time.size[1]
                                hint_text: "qty/h"
                                text: "120"
                        QuestionButton:
                            id: tc_refill_time_text
                            pos: label_tc_refill_time.x, label_tc_refill_time.texture_size[1] / 2
                            height: label_tc_refill_time.size[1]
                            on_release: root.questionpopup.open("tc_refill_time_text")

                Label:
                    size_hint_y: None
                    height: self.texture_size[1]
                    #halign: 'left'
                    text: "Czasy poszczegolnych zdarzen"

                GridLayout:
                ### G??wne ustawienia czas?w symulacji ###
                    cols: 2
                    row_force_default: True
                    row_default_height: 40

                    CustomLabel:
                        id: label_delivery_time
                        text: "Czas transportu:"
                    BoxLayout:
                        orientation: 'horizontal'
                        CustomTextInput:
                            id: delivery_time
                            height: label_delivery_time.size[1]
                            hint_text: "time"
                            text: "60"
                        QuestionButton:
                            id: transport_text
                            pos: label_delivery_time.x, label_delivery_time.texture_size[1] / 2
                            height: label_delivery_time.size[1]
                            on_release: root.questionpopup.open("transport_text")

                    CustomLabel:
                        id: label_check_in_time
                        text: "Czas przyjecia modu³ów:"
                    BoxLayout:
                        orientation: 'horizontal'
                        CustomTextInput:
                            id: check_in_time
                            height: label_check_in_time.size[1]
                            hint_text: "time"
                            text: "30"
                        QuestionButton:
                            id: check_in_text
                            pos: label_check_in_time.x, label_check_in_time.texture_size[1] / 2
                            height: label_check_in_time.size[1]
                            on_release: root.questionpopup.open("check_in_text")

                    CustomLabel:
                        id: label_conditioning_time
                        text: "Czas kondycjonowania:"
                    BoxLayout:
                        orientation: 'horizontal'
                        CustomTextInput:
                            id: conditioning_time
                            height: label_conditioning_time.size[1]
                            hint_text: "time"
                            text: "240"
                        QuestionButton:
                            id: conditioning_time_text
                            pos: label_conditioning_time.x, label_conditioning_time.texture_size[1] / 2
                            height: label_conditioning_time.size[1]
                            on_release: root.questionpopup.open("conditioning_time_text")

                    CustomLabel:
                        id: label_deployment_time
                        text: "Czas testu:"
                    BoxLayout:
                        orientation: 'horizontal'
                        CustomTextInput:
                            id: deployment_time
                            height: label_deployment_time.size[1]
                            hint_text: "time"
                            text: "15"
                        QuestionButton:
                            id: deployment_time_text
                            pos: label_deployment_time.x, label_deployment_time.texture_size[1] / 2
                            height: label_deployment_time.size[1]
                            on_release: root.questionpopup.open("deployment_time_text")

                    CustomLabel:
                        id: label_analysis_time
                        text: "Czas analizy:"
                    BoxLayout:
                        orientation: 'horizontal'
                        CustomTextInput:
                            id: analysis_time
                            height: label_analysis_time.size[1]
                            hint_text: "time"
                            text: "15"
                        QuestionButton:
                            id: analysis_time_text
                            pos: label_analysis_time.x, label_analysis_time.texture_size[1] / 2
                            height: label_analysis_time.size[1]
                            on_release: root.questionpopup.open("analysis_time_text")

            BoxLayout:
                size_hint_y: .06
                orientation: 'horizontal'
                BoxLayout:
                    padding: 2
                    Button:
                        text: 'Start'
                        on_release: root.start()

        Label:
            size_hint_x: None
            width: 2
            canvas.before:
                Color:
                    rgba: .2, .2, .2, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        BoxLayout:
            orientation: 'vertical'
            BoxLayout:
                orientation: 'vertical'

                BoxLayout:
                    padding: 2
                    size_hint_y: .05
                    Label:
                        id: screen_text_kv
                        text: ""

                    BoxLayout:
                        size_hint_x: .4
                        Spinner:
                            text: "Symulacja"
                            values: ["Symulacja 1", "Symulacja 2", "Symulacja 3", "Symulacja 4"]
                            id: graphs_spinner_kv
                            on_text: root.change_screen(graphs_spinner_kv.text)

                ScreenManager:
                    id: graphs_screens_kv
                    Graph_1:
                        id: graph_1_kv
                        name: "graph_1"
                    Graph_2_Screen:
                        id: graph_2_kv
                        name: "graph_2_screen"
                    Graph_3:
                        id: graph_3_kv
                        name: "graph_3"
                    Graph_4:
                        id: graph_4_kv
                        name: "graph_4"
            BoxLayout:
                orientation: 'horizontal'
                size_hint_y: .1
                BoxLayout:

                    orientation: 'vertical'

                    spacing: 15
                    padding: 100, 0, 100, 0
                    Slider:
                        id: time_slider_kv
                        on_value: root.slider_magic(*args)
                    BoxLayout:
                        size_hint_y: None
                        height: '40dp'
                        padding: 300, 0, 300, 0
                        BoxLayout:
                            Label:
                                text: 'Zmiana czasu wykresu'
                            Label:
                                text: str(int(time_slider_kv.value)) + ' %'
                Button:
                    size_hint_x: .2
                    text: 'Odœwierz'
                    on_release: root.refresh()


<Graph_1>:
    #id: graph_1_kv


<Graph_2_Screen>:
    id: graph_2_kv
    Graph_2:
        id: graph_2_show


<Graph_3>:
    id: graph_3_kv


<Graph_4>:
    id: graph_4_kv


<QuestionPopup>:
    size_hint: 0.3, None
    height: popup_content.height + 50
    title: "Info"
    title_size: 25
    auto_dismiss: False
    message: message
    BoxLayout:
        orientation: "vertical"
        id: popup_content
        size_hint: 1, None
        height: self.width
        padding: root.width * .08, root.height * .08
        specing: min(root.width, root.height) * .08
        Label:
            id: message
            text: "None"
            halign: "center"
            size_hint_y: None
            height: self.texture_size[1]
            text_size: (self.width, self.texture_size[1])
            #font_size: '40dp'
            markup: True
        Button:
            text: "Close"
            size_hint: 1, None
            height: '40dp'
            on_release: root.dismiss()


<ExcelPopup>:
    size_hint: .5, .5
    #height: popup_content.height + 50
    title: "Export do excela"
    title_size: 25
    BoxLayout:
        auto_dismiss: False
        size: root.size
        pos: root.pos
        orientation: "vertical"
        #fulscreen: True

        FileChooserIconView:
            id: filechooser

            path: "C:\\Users\\mateusz.sobek\\Desktop\\Logi_sim_run"

        BoxLayout:
            size_hint_y: None
            height: 30
            Label:
                size_hint_x: .4
            TextInput:
                id: file_text
                hint: 'Nazwa pliku z rozszerzeniem'
                text: ''
            Button:
                text: "Zapisz"
                on_release: root.save(filechooser.path, filechooser.text)
            Button:
                text: "Anuluj"
                on_release: root.dismiss()
            Label:
                size_hint_x: .4